<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leitor PNCP</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#f8fafc; --card:#fff; --text:#0f172a; --muted:#64748b;
  --border:#e2e8f0; --primary:#2563eb; --success:#16a34a;
  --warning:#d97706; --danger:#dc2626;
}
[data-theme="dark"] {
  --bg:#0f172a; --card:#020617; --text:#e5e7eb;
  --muted:#94a3b8; --border:#1e293b;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Inter;background:var(--bg);color:var(--text)}
header{background:var(--card);border-bottom:1px solid var(--border);padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0}
.container{max-width:1300px;margin:auto;padding:2rem}
button,input,select{padding:.6rem .75rem;border-radius:8px;border:1px solid var(--border);background:var(--card);color:var(--text)}
button{cursor:pointer}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem;margin-bottom:1rem}
.stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1rem}
.stat span{font-size:.75rem;color:var(--muted)}
.stat strong{font-size:1.2rem}
.filters{display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:1rem}
table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;font-size:.85rem}
th{background:#f1f5f9;color:var(--muted);padding:.75rem;text-align:left}
[data-theme="dark"] th{background:#020617}
td{padding:.75rem;border-bottom:1px solid var(--border);vertical-align:top}
tr:hover{background:rgba(0,0,0,.03)}
.badge{padding:.25rem .5rem;border-radius:999px;font-size:.7rem;font-weight:500}
.success{background:#dcfce7;color:var(--success)}
.warning{background:#fef3c7;color:var(--warning)}
.danger{background:#fee2e2;color:var(--danger)}
.neutral{background:#e5e7eb;color:#374151}
.descricao{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;cursor:pointer}
.descricao.expanded{-webkit-line-clamp:unset}
a{color:var(--primary);text-decoration:none}
.pagination{display:flex;justify-content:space-between;margin-top:1rem}
.loading{padding:3rem;text-align:center;color:var(--muted)}
.spinner{width:36px;height:36px;border:4px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin:auto}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<header>
  <strong>Leitor PNCP</strong>
  <button onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>
</header>

<div class="container" id="app">
  <div class="loading"><div class="spinner"></div></div>
</div>

<script>
const DATA_URL = './dados.json'; // üî¥ ALTERE AQUI

let allData=[], stats={}, search='', statusFilter='all', page=1;
const PER_PAGE=20;

document.documentElement.dataset.theme =
  localStorage.theme || 'light';

fetchData();

function toggleTheme(){
  const t=document.documentElement.dataset.theme==='dark'?'light':'dark';
  document.documentElement.dataset.theme=t;
  localStorage.theme=t;
}

function fetchData(){
  document.getElementById('app').innerHTML='<div class="loading"><div class="spinner"></div></div>';
  fetch(DATA_URL)
    .then(r=>r.json())
    .then(r=>{allData=r.data||[];stats=r.stats||{};render()})
    .catch(()=>document.getElementById('app').innerHTML='<div class="loading">Erro ao carregar JSON</div>');
}

function filtered(){
  const t=search.toLowerCase();
  return allData.filter(i=>{
    const m=!t||[i.descricao,i.vencedor,i.compra].some(v=>(v||'').toLowerCase().includes(t));
    const s=statusFilter==='all'||i.situacaoItem===statusFilter;
    return m&&s;
  });
}

function badge(s){
  if(s==='Homologado')return'<span class="badge success">Homologado</span>';
  if(s==='Fracassado')return'<span class="badge danger">Fracassado</span>';
  if(s==='Em andamento')return'<span class="badge warning">Em andamento</span>';
  return`<span class="badge neutral">${s||'-'}</span>`;
}

function render(){
  const data=filtered();
  const view=data.slice((page-1)*PER_PAGE,page*PER_PAGE);

  document.getElementById('app').innerHTML=`
  <div class="stats">
    <div class="stat"><span>Total Itens</span><strong>${stats.totalItens||0}</strong></div>
    <div class="stat"><span>Valor Estimado</span><strong>R$ ${(stats.valorTotalEstimado||0).toLocaleString('pt-BR')}</strong></div>
    <div class="stat"><span>Homologados</span><strong>${stats.itensHomologados||0}</strong></div>
    <div class="stat"><span>Fracassados</span><strong>${stats.itensFracassados||0}</strong></div>
  </div>

  <div class="filters">
    <input placeholder="Buscar..." oninput="search=this.value.trim();page=1;spinRender()">
    <select onchange="statusFilter=this.value;page=1;spinRender()">
      <option value="all">Todos status</option>
      ${[...new Set(allData.map(i=>i.situacaoItem).filter(Boolean))].map(s=>`<option>${s}</option>`).join('')}
    </select>
    <button onclick="fetchData()">Atualizar</button>
  </div>

  <table>
    <thead><tr>
      <th>Compra</th><th>Item</th><th>Descri√ß√£o</th><th>Vencedor</th><th>Status</th><th>Link</th>
    </tr></thead>
    <tbody>
      ${view.length?view.map(i=>`
        <tr>
          <td>${i.compra||'-'}</td>
          <td>${i.itemNo||'-'}</td>
          <td><div class="descricao" onclick="this.classList.toggle('expanded')">${i.descricao||'-'}</div></td>
          <td>${i.vencedor||'-'}</td>
          <td>${badge(i.situacaoItem)}</td>
          <td>${i.linkPNCP?`<a href="${i.linkPNCP}" target="_blank">Abrir</a>`:'-'}</td>
        </tr>`).join(''):`<tr><td colspan="6" class="loading">Nenhum item</td></tr>`}
    </tbody>
  </table>

  <div class="pagination">
    <button onclick="page--;spinRender()" ${page===1?'disabled':''}>Anterior</button>
    <span>P√°gina ${page}</span>
    <button onclick="page++;spinRender()" ${(page*PER_PAGE)>=data.length?'disabled':''}>Pr√≥xima</button>
  </div>`;
}

function spinRender(){
  document.getElementById('app').querySelector('table').style.opacity=.4;
  setTimeout(render,200);
}
</script>
</body>
</html>
